<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>KB 손해보험 이미지 서비스</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        warm: {
                            50: '#faf7f2',
                            100: '#f5efe6',
                            200: '#e8dfd0',
                            300: '#d9ccb8',
                            400: '#c4ad8f',
                            500: '#a68b5b',
                            600: '#8b7355',
                            700: '#6d5a45',
                            800: '#5a4a3a',
                            900: '#3d342a',
                        },
                        accent: {
                            DEFAULT: '#d4a574',
                            hover: '#c4955f',
                            light: '#e8c9a8',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn { animation: fadeIn 0.3s ease-out; }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin { animation: spin 1s linear infinite; }

        .btn-hover { transition: all 0.2s ease; }
        .btn-hover:hover { transform: translateY(-2px); }
        .btn-hover:active { transform: translateY(0); }
    </style>
</head>
<body class="bg-gradient-to-br from-warm-50 via-warm-100 to-warm-200 min-h-screen"
      {{#success}}data-success="{{success}}" data-image-url="{{imageUrl}}" data-display-url="{{displayUrl}}" data-s3-key="{{s3Key}}"{{/success}}
      data-message="{{message}}"
      {{#isQuotaExceeded}}data-is-quota-exceeded="{{isQuotaExceeded}}"{{/isQuotaExceeded}}>

    <div class="min-h-screen flex flex-col">
        {{> partials/header}}

        <!-- 메인 콘텐츠 -->
        <main class="flex-1 py-8 px-4 sm:px-6 lg:px-8">
            <div class="max-w-2xl mx-auto">
                <!-- 공지사항: 데이터 복구 안내 -->
                <div class="mb-6 bg-amber-50 border border-amber-200 rounded-xl p-4 shadow-sm">
                    <div class="flex items-start gap-3">
                        <svg class="w-6 h-6 text-amber-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                        </svg>
                        <div>
                            <h3 class="font-semibold text-amber-800 mb-1">서비스 복구 안내</h3>
                            <p class="text-amber-700 text-sm leading-relaxed">
                                서버 점검 과정에서 일부 이미지 데이터가 손실되었습니다.
                                현재 백업 데이터를 기반으로 복구를 완료하였으나, 일부 최근 생성된 이미지는 복구되지 않았을 수 있습니다.
                                불편을 드려 진심으로 사과드립니다. 추가적인 문의는 jihoostudy1@gmail.com으로 보내주시면 감사하겠습니다.<br>
                                <i>12/10 ~ 12/12</i>
                            </p>
                        </div>
                    </div>
                </div>

                <!-- 공지사항: 사용 방법 안내 -->
                <div class="mb-6 bg-sky-50 border border-sky-200 rounded-xl p-4 shadow-sm">
                    <div class="flex items-start gap-3">
                        <svg class="w-6 h-6 text-sky-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <div>
                            <h3 class="font-semibold text-sky-800 mb-1">사용 방법 안내</h3>
                            <p class="text-sky-700 text-sm leading-relaxed">
                                <b>-- [접속하기] --</b> <br>
                                1. 구글에 'KB손해보험 김포 한강지점 이미지 생성 서비스'를 검색합니다. <br>
                                2. 우측 상단의 별모양 아이콘을 클릭하여 현재 사이트를 즐겨찾기에 등록합니다.(PC 기준) <br>
                                3. 또는 밴드에 공개된 링크를 클릭하여 접속합니다. <br>
                                <br>
                                <b>-- [이미지 생성하기] --</b> <br>
                                1. 이미지 생성 조건를 입력합니다. <br>
                                2. 참고 이미지를 첨부할 수 있습니다(선택사항). <br>
                                3. '이미지 생성' 버튼을 클릭합니다. <br>
                                4. 생성된 이미지를 확인하고 다운로드하거나 즐겨찾기에 추가할 수 있습니다. <br>
                                5. 생성된 이미지는 전체 보기에 저장되어 모두에게 공유됩니다. <br>
                                <br>
                                <b>-- [이미지 다운로드] --</b> <br>
                                1. 생성된 이미지 아래의 '다운로드' 버튼을 클릭합니다. <br>
                                2. 전체 보기 이미지 아래의 '다운로드' 버튼을 클릭합니다. <br>
                                <br>
                                <b>-- [전체 보기] --</b> <br>
                                1. 우측 상단에 네모 아이콘을 클릭합니다. <br>
                                2. 지금까지 생성된 모든 이미지를 확인할 수 있습니다. <br>
                                3. 가장 최신에 생성된 이미지부터 확인이 가능합니다. <br>
                                <br>
                                <b>-- [즐겨찾기] --</b> <br>
                                1. 우측 상단의 구글 버튼을 클릭하여 구글 로그인을 진행합니다. <br>
                                2. 이미지의 하트 아이콘을 클릭하여 즐겨찾기에 추가합니다. <br>
                                3. 좌측 상단의 하트 아이콘을 클릭합니다. <br>
                                4. 지금까지 즐겨찾기한 모든 이미지를 확인할 수 있습니다. <br>
                            </p>
                        </div>
                    </div>
                </div>

                <!-- 로딩 상태 -->
                <div id="loadingDiv" class="hidden">
                    <div class="bg-white rounded-2xl shadow-xl p-8 md:p-12 text-center animate-fadeIn">
                        <div class="w-16 h-16 border-4 border-warm-200 border-t-accent rounded-full animate-spin mx-auto mb-6"></div>
                        <h3 class="text-xl font-semibold text-warm-800 mb-2">이미지 생성 중...</h3>
                        <p class="text-warm-600">AI가 멋진 이미지를 만들고 있습니다. 잠시만 기다려주세요.</p>
                    </div>
                </div>

                <!-- 결과 표시 -->
                <div id="resultDiv" class="hidden mb-8 animate-fadeIn">
                    <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
                        <div class="relative group cursor-pointer" onclick="openImageInNewTab()">
                            <img id="resultImage" alt="생성된 이미지" data-s3-key="" data-display-url=""
                                 class="w-full h-auto object-contain bg-warm-100" />
                            <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center">
                                <span class="opacity-0 group-hover:opacity-100 transition-opacity text-white bg-black/50 px-4 py-2 rounded-lg text-sm">
                                    클릭하여 원본 보기
                                </span>
                            </div>
                        </div>
                        <div class="p-6">
                            <div class="flex flex-col sm:flex-row gap-3">
                                <a id="downloadBtn" download target="_blank"
                                   class="btn-hover flex-1 inline-flex items-center justify-center gap-2 bg-warm-800 hover:bg-warm-900 text-accent px-6 py-3 rounded-xl font-semibold shadow-lg">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                                    </svg>
                                    다운로드
                                </a>
                                <button type="button" onclick="saveFavorite()"
                                        class="btn-hover flex-1 inline-flex items-center justify-center gap-2 bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white px-6 py-3 rounded-xl font-semibold shadow-lg">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                    </svg>
                                    즐겨찾기
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 이미지 생성 폼 -->
                <form id="generateForm" action="/generate" method="post" enctype="multipart/form-data" onsubmit="showLoading(event)">
                    <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8">
                        <h2 class="text-2xl font-bold text-warm-800 mb-6 text-center">
                            AI 이미지 생성
                        </h2>

                        <!-- 이미지 첨부 -->
                        <div class="mb-6">
                            <label class="block text-sm font-semibold text-warm-700 mb-3">
                                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                                참고 이미지 (선택사항)
                            </label>
                            <input type="file" id="attachImage" name="attachImage" accept="image/*" class="hidden" onchange="handleImageAttachment(event)">
                            <button type="button" id="uploadBtn" onclick="document.getElementById('attachImage').click()"
                                    class="btn-hover w-full border-2 border-dashed border-warm-300 hover:border-accent rounded-xl p-6 text-center transition-colors group">
                                <svg id="uploadIcon" class="w-10 h-10 mx-auto text-warm-400 group-hover:text-accent mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                </svg>
                                <span id="uploadText" class="text-warm-600 group-hover:text-accent font-medium">이미지를 드래그하거나 클릭하여 업로드</span>
                                <span id="uploadHint" class="block text-warm-400 text-sm mt-1">PNG, JPG, WEBP (최대 10MB)</span>
                            </button>
                            <div id="attachmentStatus" class="hidden mt-3 bg-accent/10 border border-accent/30 rounded-xl p-4">
                                <!-- 미리보기 이미지 -->
                                <div class="mb-3">
                                    <img id="imagePreview" src="" alt="미리보기" class="w-full max-h-48 object-contain rounded-lg bg-warm-100" />
                                </div>
                                <!-- 파일 정보 -->
                                <div class="flex items-center gap-3">
                                    <svg class="w-5 h-5 text-accent flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"/>
                                    </svg>
                                    <span id="attachmentFileName" class="flex-1 text-warm-700 font-medium truncate"></span>
                                    <button type="button" onclick="removeAttachment()" class="btn-hover w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 프롬프트 입력 -->
                        <div class="mb-6">
                            <label for="prompt" class="block text-sm font-semibold text-warm-700 mb-3">
                                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                                </svg>
                                이미지 생성 조건 <span class="text-red-500">*</span>
                            </label>
                            <textarea id="prompt" name="prompt" required rows="5"
                                      placeholder="예: 오늘의 가장 중요한 이슈와 연결해서 생성해 주세요."
                                      class="w-full px-4 py-3 border-2 border-warm-200 rounded-xl focus:border-accent focus:ring-2 focus:ring-accent/20 outline-none transition-all resize-none text-warm-800 placeholder-warm-400">{{#prompt}}{{prompt}}{{/prompt}}</textarea>
                            <p class="text-warm-500 text-sm mt-2">
                                💡 구체적인 설명일수록 더 정확한 이미지가 생성됩니다.
                            </p>
                        </div>

                        <!-- 버튼 그룹 -->
                        <div class="flex flex-col sm:flex-row gap-3">
                            <button type="submit" class="btn-hover flex-1 bg-gradient-to-r from-accent to-accent-hover hover:from-accent-hover hover:to-accent text-white px-6 py-4 rounded-xl font-bold text-lg shadow-lg shadow-accent/30">
                                <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                                </svg>
                                이미지 생성
                            </button>
                            <button type="button" onclick="confirmReset()" class="btn-hover sm:w-auto bg-warm-200 hover:bg-warm-300 text-warm-700 px-6 py-4 rounded-xl font-semibold">
                                <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                </svg>
                                초기화
                            </button>
                        </div>
                    </div>
                </form>

                <!-- 안내 메시지 -->
                <div class="mt-8 text-center text-warm-500 text-sm">
                    <p>KB 손해보험 김포 한강 지점 전용 이미지 생성 서비스입니다.</p>
                    <p class="mt-1">생성된 이미지는 마케팅 및 홍보 목적으로 사용할 수 있습니다.</p>
                </div>
            </div>
        </main>

        {{> partials/footer}}
    </div>

    <script src="/js/script.js"></script>
</body>
</html>
