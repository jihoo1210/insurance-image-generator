<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>KB ì†í•´ë³´í—˜ ì´ë¯¸ì§€ ì„œë¹„ìŠ¤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        warm: {
                            50: '#faf7f2',
                            100: '#f5efe6',
                            200: '#e8dfd0',
                            300: '#d9ccb8',
                            400: '#c4ad8f',
                            500: '#a68b5b',
                            600: '#8b7355',
                            700: '#6d5a45',
                            800: '#5a4a3a',
                            900: '#3d342a',
                        },
                        accent: {
                            DEFAULT: '#d4a574',
                            hover: '#c4955f',
                            light: '#e8c9a8',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn { animation: fadeIn 0.3s ease-out; }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin { animation: spin 1s linear infinite; }

        .btn-hover { transition: all 0.2s ease; }
        .btn-hover:hover { transform: translateY(-2px); }
        .btn-hover:active { transform: translateY(0); }

        /* í† ìŠ¤íŠ¸ ì•Œë¦¼ */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideUp {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-warm-50 via-warm-100 to-warm-200 min-h-screen"
      {{#success}}data-success="{{success}}" data-image-url="{{imageUrl}}" data-s3-key="{{s3Key}}"{{/success}}
      data-message="{{message}}"
      {{#isQuotaExceeded}}data-is-quota-exceeded="{{isQuotaExceeded}}"{{/isQuotaExceeded}}>

    <div class="min-h-screen flex flex-col">
        <!-- í—¤ë” -->
        <header class="bg-gradient-to-r from-warm-800 to-warm-900 shadow-lg">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16 md:h-20">
                    <!-- ì¢Œì¸¡: ë„¤ë¹„ê²Œì´ì…˜ -->
                    <div class="flex items-center gap-2 md:gap-3">
                        <a href="/list" class="btn-hover inline-flex items-center justify-center gap-2 bg-warm-600 hover:bg-warm-500 text-white w-10 h-10 md:w-28 md:h-10 rounded-lg text-sm font-medium shadow-md">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
                            </svg>
                            <span class="hidden md:inline">ì „ì²´ë³´ê¸°</span>
                        </a>
                        <button type="button" id="favoritesBtn" onclick="goToFavorites()" class="btn-hover inline-flex items-center justify-center gap-2 bg-accent hover:bg-accent-hover text-white w-10 h-10 md:w-28 md:h-10 rounded-lg text-sm font-medium shadow-md">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                            </svg>
                            <span class="hidden md:inline">ì¦ê²¨ì°¾ê¸°</span>
                        </button>
                    </div>

                    <!-- ì¤‘ì•™: ë¡œê³  -->
                    <div class="flex-1 text-center px-4">
                        <h1 class="text-lg md:text-2xl font-bold text-accent">KB ì†í•´ë³´í—˜</h1>
                        <p class="text-warm-300 text-xs md:text-sm hidden sm:block">ê¹€í¬ í•œê°• ì§€ì  ì´ë¯¸ì§€ ì„œë¹„ìŠ¤</p>
                    </div>

                    <!-- ìš°ì¸¡: ë¡œê·¸ì¸ -->
                    <div class="flex items-center">
                        {{#User}}
                        <div class="flex items-center gap-2 md:gap-3 bg-warm-700/50 rounded-full px-3 py-1.5 md:px-4 md:py-2">
                            <span class="user-email text-accent text-sm font-medium truncate max-w-[100px] md:max-w-[150px]">{{User.email}}</span>
                            <a href="/auth/logout" class="btn-hover bg-red-500 hover:bg-red-600 text-white px-2 py-1 md:px-3 md:py-1.5 rounded-full text-xs font-medium">
                                ë¡œê·¸ì•„ì›ƒ
                            </a>
                        </div>
                        {{/User}}
                        {{^User}}
                        <a href="/oauth2/authorization/google" class="btn-hover inline-flex items-center justify-center gap-2 bg-white hover:bg-gray-50 text-gray-700 w-10 h-10 md:w-28 md:h-10 rounded-lg text-sm font-medium shadow-md">
                            <svg class="w-4 h-4" viewBox="0 0 24 24">
                                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                            </svg>
                            <span class="hidden md:inline">ë¡œê·¸ì¸</span>
                        </a>
                        {{/User}}
                    </div>
                </div>
            </div>
        </header>

        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <main class="flex-1 py-8 px-4 sm:px-6 lg:px-8">
            <div class="max-w-2xl mx-auto">
                <!-- ê³µì§€ì‚¬í•­: ë°ì´í„° ë³µêµ¬ ì•ˆë‚´ -->
                <div class="mb-6 bg-amber-50 border border-amber-200 rounded-xl p-4 shadow-sm">
                    <div class="flex items-start gap-3">
                        <svg class="w-6 h-6 text-amber-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                        </svg>
                        <div>
                            <h3 class="font-semibold text-amber-800 mb-1">ì„œë¹„ìŠ¤ ë³µêµ¬ ì•ˆë‚´</h3>
                            <p class="text-amber-700 text-sm leading-relaxed">
                                ì„œë²„ ì ê²€ ê³¼ì •ì—ì„œ ì¼ë¶€ ì´ë¯¸ì§€ ë°ì´í„°ê°€ ì†ì‹¤ë˜ì—ˆìŠµë‹ˆë‹¤.
                                í˜„ì¬ ë°±ì—… ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë³µêµ¬ë¥¼ ì™„ë£Œí•˜ì˜€ìœ¼ë‚˜, ì¼ë¶€ ìµœê·¼ ìƒì„±ëœ ì´ë¯¸ì§€ëŠ” ë³µêµ¬ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                ë¶ˆí¸ì„ ë“œë ¤ ì§„ì‹¬ìœ¼ë¡œ ì‚¬ê³¼ë“œë¦½ë‹ˆë‹¤.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- ë¡œë”© ìƒíƒœ -->
                <div id="loadingDiv" class="hidden">
                    <div class="bg-white rounded-2xl shadow-xl p-8 md:p-12 text-center animate-fadeIn">
                        <div class="w-16 h-16 border-4 border-warm-200 border-t-accent rounded-full animate-spin mx-auto mb-6"></div>
                        <h3 class="text-xl font-semibold text-warm-800 mb-2">ì´ë¯¸ì§€ ìƒì„± ì¤‘...</h3>
                        <p class="text-warm-600">AIê°€ ë©‹ì§„ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ê³  ìˆìŠµë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
                    </div>
                </div>

                <!-- ê²°ê³¼ í‘œì‹œ -->
                <div id="resultDiv" class="hidden mb-8 animate-fadeIn">
                    <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
                        <div class="relative group cursor-pointer" onclick="openImageInNewTab()">
                            <img id="resultImage" alt="ìƒì„±ëœ ì´ë¯¸ì§€" data-s3-key=""
                                 class="w-full h-auto object-contain bg-warm-100" />
                            <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center">
                                <span class="opacity-0 group-hover:opacity-100 transition-opacity text-white bg-black/50 px-4 py-2 rounded-lg text-sm">
                                    í´ë¦­í•˜ì—¬ ì›ë³¸ ë³´ê¸°
                                </span>
                            </div>
                        </div>
                        <div class="p-6">
                            <div class="flex flex-col sm:flex-row gap-3">
                                <a id="downloadBtn" download target="_blank"
                                   class="btn-hover flex-1 inline-flex items-center justify-center gap-2 bg-warm-800 hover:bg-warm-900 text-accent px-6 py-3 rounded-xl font-semibold shadow-lg">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                                    </svg>
                                    ë‹¤ìš´ë¡œë“œ
                                </a>
                                <button type="button" onclick="saveFavorite()"
                                        class="btn-hover flex-1 inline-flex items-center justify-center gap-2 bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white px-6 py-3 rounded-xl font-semibold shadow-lg">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                    </svg>
                                    ì¦ê²¨ì°¾ê¸°
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì´ë¯¸ì§€ ìƒì„± í¼ -->
                <form id="generateForm" action="/generate" method="post" enctype="multipart/form-data" onsubmit="showLoading(event)">
                    <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8">
                        <h2 class="text-2xl font-bold text-warm-800 mb-6 text-center">
                            AI ì´ë¯¸ì§€ ìƒì„±
                        </h2>

                        <!-- ì´ë¯¸ì§€ ì²¨ë¶€ -->
                        <div class="mb-6">
                            <label class="block text-sm font-semibold text-warm-700 mb-3">
                                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                                ì°¸ê³  ì´ë¯¸ì§€ (ì„ íƒì‚¬í•­)
                            </label>
                            <input type="file" id="attachImage" name="attachImage" accept="image/*" class="hidden" onchange="handleImageAttachment(event)">
                            <button type="button" id="uploadBtn" onclick="document.getElementById('attachImage').click()"
                                    class="btn-hover w-full border-2 border-dashed border-warm-300 hover:border-accent rounded-xl p-6 text-center transition-colors group">
                                <svg id="uploadIcon" class="w-10 h-10 mx-auto text-warm-400 group-hover:text-accent mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                </svg>
                                <span id="uploadText" class="text-warm-600 group-hover:text-accent font-medium">ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</span>
                                <span id="uploadHint" class="block text-warm-400 text-sm mt-1">PNG, JPG, WEBP (ìµœëŒ€ 10MB)</span>
                            </button>
                            <div id="attachmentStatus" class="hidden mt-3 bg-accent/10 border border-accent/30 rounded-xl p-4">
                                <!-- ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ -->
                                <div class="mb-3">
                                    <img id="imagePreview" src="" alt="ë¯¸ë¦¬ë³´ê¸°" class="w-full max-h-48 object-contain rounded-lg bg-warm-100" />
                                </div>
                                <!-- íŒŒì¼ ì •ë³´ -->
                                <div class="flex items-center gap-3">
                                    <svg class="w-5 h-5 text-accent flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"/>
                                    </svg>
                                    <span id="attachmentFileName" class="flex-1 text-warm-700 font-medium truncate"></span>
                                    <button type="button" onclick="removeAttachment()" class="btn-hover w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- í”„ë¡¬í”„íŠ¸ ì…ë ¥ -->
                        <div class="mb-6">
                            <label for="prompt" class="block text-sm font-semibold text-warm-700 mb-3">
                                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                                </svg>
                                ì´ë¯¸ì§€ ìƒì„± ì¡°ê±´ <span class="text-red-500">*</span>
                            </label>
                            <textarea id="prompt" name="prompt" required rows="5"
                                      placeholder="ì˜ˆ: ê°€ì¡±ì´ í•¨ê»˜ ìˆëŠ” ë”°ëœ»í•œ ë¶„ìœ„ê¸°ì˜ ë³´í—˜ ê´‘ê³  ì´ë¯¸ì§€, ì•ˆì „ê³¼ ì‹ ë¢°ë¥¼ ê°•ì¡°í•˜ëŠ” ëŠë‚Œìœ¼ë¡œ..."
                                      class="w-full px-4 py-3 border-2 border-warm-200 rounded-xl focus:border-accent focus:ring-2 focus:ring-accent/20 outline-none transition-all resize-none text-warm-800 placeholder-warm-400">{{#prompt}}{{prompt}}{{/prompt}}</textarea>
                            <p class="text-warm-500 text-sm mt-2">
                                ğŸ’¡ êµ¬ì²´ì ì¸ ì„¤ëª…ì¼ìˆ˜ë¡ ë” ì •í™•í•œ ì´ë¯¸ì§€ê°€ ìƒì„±ë©ë‹ˆë‹¤.
                            </p>
                        </div>

                        <!-- ë²„íŠ¼ ê·¸ë£¹ -->
                        <div class="flex flex-col sm:flex-row gap-3">
                            <button type="submit" class="btn-hover flex-1 bg-gradient-to-r from-accent to-accent-hover hover:from-accent-hover hover:to-accent text-white px-6 py-4 rounded-xl font-bold text-lg shadow-lg shadow-accent/30">
                                <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                                </svg>
                                ì´ë¯¸ì§€ ìƒì„±
                            </button>
                            <button type="button" onclick="confirmReset()" class="btn-hover sm:w-auto bg-warm-200 hover:bg-warm-300 text-warm-700 px-6 py-4 rounded-xl font-semibold">
                                <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                </svg>
                                ì´ˆê¸°í™”
                            </button>
                        </div>
                    </div>
                </form>

                <!-- ì•ˆë‚´ ë©”ì‹œì§€ -->
                <div class="mt-8 text-center text-warm-500 text-sm">
                    <p>KB ì†í•´ë³´í—˜ ê¹€í¬ í•œê°• ì§€ì  ì „ìš© ì´ë¯¸ì§€ ìƒì„± ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.</p>
                    <p class="mt-1">ìƒì„±ëœ ì´ë¯¸ì§€ëŠ” ë§ˆì¼€íŒ… ë° í™ë³´ ëª©ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
            </div>
        </main>

        <!-- í‘¸í„° -->
        <footer class="bg-warm-800 text-warm-400 py-4">
            <div class="max-w-7xl mx-auto px-4 text-center text-sm">
                <p>&copy; 2024 KB ì†í•´ë³´í—˜ ê¹€í¬ í•œê°• ì§€ì . Powered by Google Gemini AI.</p>
            </div>
        </footer>
    </div>

    <!-- í† ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ -->
    <div id="toastContainer"></div>

    <script src="/js/script.js"></script>
</body>
</html>
